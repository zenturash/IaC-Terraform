# Example terraform.tfvars file for Azure Multi-VM OpenTofu Module
# Copy this file to terraform.tfvars and customize the values

# Global Configuration
admin_username = "azureuser"
admin_password = "YourSecurePassword123!"  # Change this to a secure password
location       = "West Europe"

# Network Configuration
vnet_cidr = "10.0.0.0/20"

# AUTOMATIC SUBNET CALCULATION - New Feature!
# Define subnet names - CIDRs will be automatically calculated sequentially
subnet_names = ["subnet-web", "subnet-app", "subnet-db", "subnet-mgmt"]
# Result: 10.0.0.0/24, 10.0.1.0/24, 10.0.2.0/24, 10.0.3.0/24

# Optional: Create a gateway subnet for VPN/ExpressRoute (will be placed at the very end)
create_gateway_subnet = true
# Result: GatewaySubnet will be at 10.0.15.0/24 (last /24 in the /20 range)

# VPN Configuration (optional)
enable_vpn = true
vpn_configuration = {
  vpn_gateway_name = "vpn-gateway-main"
  vpn_gateway_sku  = "VpnGw1"        # Options: Basic, VpnGw1, VpnGw2, VpnGw3, VpnGw1AZ, etc.
  vpn_type         = "RouteBased"    # RouteBased or PolicyBased
  enable_bgp       = false           # Enable BGP routing
  
  local_network_gateway = {
    name            = "local-gateway-office"
    gateway_address = "203.0.113.12"           # Replace with your public IP
    address_space   = ["192.168.0.0/16"]       # Replace with your on-premises networks
  }
  
  vpn_connection = {
    name                = "vpn-connection-office"
    shared_key          = "YourSecureSharedKey123!"  # Change this!
    connection_protocol = "IKEv2"
  }
}

# Define multiple virtual machines with NSG rules
virtual_machines = {
  "web-vm-01" = {
    vm_size             = "Standard_B2s"
    subnet_name         = "subnet-web"
    resource_group_name = "rg-web-tier"
    enable_public_ip    = true
    os_disk_type        = "Premium_LRS"
    nsg_rules = [
      {
        name                       = "AllowRDP"
        priority                   = 1000
        direction                  = "Inbound"
        access                     = "Allow"
        protocol                   = "Tcp"
        source_port_range          = "*"
        destination_port_range     = "3389"
        source_address_prefix      = "YOUR_IP_ADDRESS/32"  # Replace with your IP
        destination_address_prefix = "*"
      },
      {
        name                       = "AllowHTTP"
        priority                   = 1010
        direction                  = "Inbound"
        access                     = "Allow"
        protocol                   = "Tcp"
        source_port_range          = "*"
        destination_port_range     = "80"
        source_address_prefix      = "*"
        destination_address_prefix = "*"
      },
      {
        name                       = "AllowHTTPS"
        priority                   = 1020
        direction                  = "Inbound"
        access                     = "Allow"
        protocol                   = "Tcp"
        source_port_range          = "*"
        destination_port_range     = "443"
        source_address_prefix      = "*"
        destination_address_prefix = "*"
      }
    ]
  }
  "app-vm-01" = {
    vm_size             = "Standard_D2s_v3"
    subnet_name         = "subnet-app"
    resource_group_name = "rg-app-tier"
    enable_public_ip    = false
    os_disk_type        = "Premium_LRS"
    # No NSG rules needed for private VMs (NSG only created when enable_public_ip = true)
  }
  "mgmt-vm-01" = {
    vm_size             = "Standard_B1s"
    subnet_name         = "subnet-mgmt"
    resource_group_name = "rg-management"
    enable_public_ip    = true
    os_disk_type        = "StandardSSD_LRS"
    nsg_rules = [
      {
        name                       = "AllowRDPFromOffice"
        priority                   = 1000
        direction                  = "Inbound"
        access                     = "Allow"
        protocol                   = "Tcp"
        source_port_range          = "*"
        destination_port_range     = "3389"
        source_address_prefix      = "YOUR_OFFICE_IP/32"  # Replace with your office IP
        destination_address_prefix = "*"
      }
    ]
  }
}

# AUTOMATIC SUBNET CALCULATION EXAMPLES:

# Example 1: Simple 3-tier architecture
# subnet_names = ["web", "app", "db"]
# create_gateway_subnet = false
# Result: 10.0.0.0/24, 10.0.1.0/24, 10.0.2.0/24

# Example 2: With gateway subnet for hybrid connectivity
# subnet_names = ["frontend", "backend", "data"]
# create_gateway_subnet = true
# Result: 10.0.0.0/24, 10.0.1.0/24, 10.0.2.0/24, GatewaySubnet: 10.0.15.0/24

# Example 3: Large deployment with many subnets
# subnet_names = ["web1", "web2", "app1", "app2", "db1", "db2", "mgmt", "dmz"]
# create_gateway_subnet = true
# Result: 8 sequential /24 subnets + GatewaySubnet at 10.0.15.0/24

# Benefits of Automatic Calculation:
# ✅ No manual CIDR math required
# ✅ Sequential allocation prevents overlaps
# ✅ Gateway subnet automatically placed at end of address space
# ✅ Easy to add/remove subnets by updating the list
# ✅ Consistent /24 sizing for all subnets

# NSG Rule Examples:
# Common protocols: "Tcp", "Udp", "Icmp", "*"
# Common ports: "22" (SSH), "80" (HTTP), "443" (HTTPS), "3389" (RDP), "5985-5986" (WinRM)
# Source IP examples: 
#   - "YOUR_IP/32" (specific IP)
#   - "192.168.1.0/24" (IP range)
#   - "*" (any IP - use carefully!)
#   - "VirtualNetwork" (within VNet)
#   - "Internet" (from internet)
